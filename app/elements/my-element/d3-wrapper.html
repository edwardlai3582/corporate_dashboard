
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="./d3-pie.html">

<dom-module id="d3-wrapper">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        width:100%;  
      }
    </style>
    <d3-pie data-array="{{dataArray}}"></d3-pie>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'd3-wrapper',

        properties: {
            dataArray:{
                type: Array,
            },
            dataName:{
                type: String,
            }
        },
        behaviors: [
            Polymer.IronResizableBehavior
        ],
        setArray: function(data) {
            this.set("dataArray", data);
            console.log(this.dataArray);
            ///////////////////////////////
            var tempObj={};
            tempObj.amount=333;
            tempObj.id=5;
            tempObj.type="QQQ";
            var qq = function () {
                this.push("dataArray", tempObj); 
                console.log("qq");
            };
            setTimeout(qq.bind(this), 3000);
        },
        parseData: function(url, callBack) {
            Papa.parse(url, {
                header: true,
                dynamicTyping: true,
                download: true,
                complete: function(results) {
                    callBack(results.data);
                }
            });
        },  
        ready: function() {
            var dataPath = "../../data/"+this.dataName;
            this.parseData(dataPath, this.setArray.bind(this));
            console.log("wrapper ready:"+this.dataArray);
        },
        attached: function(){
            console.log("wrapper attached:"+this.dataArray);    
        }  
          
      });
    })();
  </script>
</dom-module>
