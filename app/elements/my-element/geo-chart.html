
<link rel="import" href="../../bower_components/polymer/polymer.html">  
<link rel="import" href="../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../../bower_components/google-chart/google-chart.html">
<link rel="stylesheet" href="../../bower_components/google-chart/google-chart.css">

<dom-module id="geo-chart">
    <template>
         <style>
            :host {
                display: block;
                width: 100%;
            }
            google-chart {
                width: 100%;
            }                
        </style>

     <google-chart type="geo" id="geo_chart" data="{{dataArray}}" options="{{options}}">
  </google-chart>

   
    </template>
    <script>
        Polymer({
            is: 'geo-chart',
            behaviors: [
              Polymer.IronResizableBehavior
            ],
            listeners: {
              'iron-resize': '_onIronResize'
            },
            properties: {
                dataArray:{
                    type: Array,
                    value: function(){return [];},
                    //observer: '_dataArrayChanged',
                },
                options:{
                    type: Object,
                    value: function(){
                             return { 
                                 region: 'US',
                                 displayMode: 'regions',
                                 resolution: 'provinces',
                                 colorAxis: {colors: ['pink','#E68193', 'purple']},
                                 backgroundColor: '#1087B5',
                                 datalessRegionColor: 'black',
                                 defaultColor: '#f5f5f5'
                            };},
                },
                chartdone:{
                    type: Boolean,
                    value: true,
                }
            },
             observers: [
                '_updateDataArrayItems(dataArray.*)'
            ],
            _updateDataArrayItems : function(newValue, oldValue) {
                //this.drawChart(this.dataArray);
                //console.log("===============");
                //console.log(newValue);
                //if(newValue.value.length!==0){
                    //this.setD3(800, 300);
                    //this.drawChart(newValue);
                //}
                //this.drawChart(newValue);
            },
            _dataArrayChanged: function(newValue, oldValue){ 
                //console.log("CHANGED:"+newValue);
                //this.drawChart(this.dataArray);
            },
            ready: function() {
                //console.log("line ready:");
                //this.setD3(800, 300);
                ///this.drawChart(this.dataArray);
            },
            
            attached: function(){
                this.async(this.notifyResize, 1);
            },
            get parent() {
              if (this.parentNode.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {
                return this.parentNode.host;
              }
              return this.parentNode;
            },
            _onIronResize: function() {
                if(this.chartdone){
                    this.chartdone= false;
                    setTimeout(this.redraw.bind(this),300);
                }  
            },
            redraw: function(){
                document.getElementById('geo_chart').drawChart(); 
                this.chartdone = true;    
            }
        });
    </script>
</dom-module>